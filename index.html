<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LexiQuest Kids - Arabic Voice Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #080808; color: #fff; font-family: 'Tajawal', sans-serif; touch-action: manipulation; }
        .linear-card { background: #111; border: 1px solid rgba(255,255,255,0.08); border-radius: 32px; }
        .option-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 18px; font-weight: bold; transition: all 0.2s; }
        .correct { background: #10b981 !important; color: white !important; }
        .wrong { background: #ef4444 !important; color: white !important; }
        .image-frame { width: 100%; height: 220px; border-radius: 24px; background: #1a1a1a; overflow: hidden; }
        img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

    <div id="app" class="max-w-md mx-auto min-h-screen p-4 flex flex-col justify-center text-center">
        <p class="text-gray-500">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©...</p>
    </div>

    <div id="celebration" class="fixed inset-0 bg-black/95 z-50 hidden flex-col items-center justify-center text-center p-6 text-white">
        <div class="text-8xl mb-6">ğŸ†</div>
        <h2 class="text-4xl font-bold mb-4 text-yellow-400">Ø¨Ø·Ù„ Ù…Ø°Ù‡Ù„!</h2>
        <p class="text-xl mb-8">Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ 5 ÙƒÙ„Ù…Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!</p>
        <button onclick="closeCelebration()" class="bg-blue-600 px-12 py-4 rounded-full font-bold text-xl">Ø§Ø³ØªÙ…Ø±</button>
    </div>

    <script>
        const wordBank = [
            {en: "Lion", ar: "Ø£Ø³Ø¯"}, {en: "Tiger", ar: "Ù†Ù…Ø±"}, {en: "Elephant", ar: "ÙÙŠÙ„"}, {en: "Giraffe", ar: "Ø²Ø±Ø§ÙØ©"},
            {en: "Apple", ar: "ØªÙØ§Ø­Ø©"}, {en: "Banana", ar: "Ù…ÙˆØ²"}, {en: "Orange", ar: "Ø¨Ø±ØªÙ‚Ø§Ù„"}, {en: "Carrot", ar: "Ø¬Ø²Ø±Ø©"},
            {en: "Car", ar: "Ø³ÙŠØ§Ø±Ø©"}, {en: "Airplane", ar: "Ø·Ø§Ø¦Ø±Ø©"}, {en: "Rocket", ar: "ØµØ§Ø±ÙˆØ®"}, {en: "Bicycle", ar: "Ø¯Ø±Ø§Ø¬Ø©"},
            {en: "Eye", ar: "Ø¹ÙŠÙ†"}, {en: "Hand", ar: "ÙŠØ¯"}, {en: "Nose", ar: "Ø£Ù†Ù"}, {en: "Heart", ar: "Ù‚Ù„Ø¨"},
            {en: "Oman", ar: "Ø¹Ù…Ø§Ù†"}, {en: "Egypt", ar: "Ù…ØµØ±"}, {en: "Earth", ar: "Ø§Ù„Ø£Ø±Ø¶"}, {en: "Moon", ar: "Ù‚Ù…Ø±"}
        ];

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        for(let i=1; i<=100; i++) { wordBank.push({en: String(i), ar: "Ø§Ù„Ø±Ù‚Ù… " + i}); }

        let currentWord = null;
        let score = 0;
        let streak = 0;
        let voices = [];

        // ØªØ­Ø³ÙŠÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
        function initVoices() {
            voices = window.speechSynthesis.getVoices();
        }
        window.speechSynthesis.onvoiceschanged = initVoices;
        initVoices();

        function speak(text, lang) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            
            // Ù…Ø­Ø±Ùƒ Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙˆØª Ø§Ù„Ø¹Ø±Ø¨ÙŠ
            if(lang === 'ar') {
                msg.lang = 'ar-SA';
                const arVoice = voices.find(v => v.lang.startsWith('ar'));
                if(arVoice) msg.voice = arVoice;
            } else {
                msg.lang = 'en-US';
                const enVoice = voices.find(v => v.lang.startsWith('en'));
                if(enVoice) msg.voice = enVoice;
            }

            msg.rate = 0.85;
            window.speechSynthesis.speak(msg);
        }

        function renderHome() {
            document.getElementById('app').innerHTML = `
                <div class="linear-card p-10">
                    <h1 class="text-3xl font-bold mb-6 italic">LexiQuest Game</h1>
                    <button onclick="nextRound()" class="w-full bg-white text-black py-4 rounded-2xl font-bold text-xl">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ ğŸ®</button>
                    <p class="mt-4 text-xs text-gray-500 italic font-mono">ARABIC VOICE FIX V2</p>
                </div>
            `;
        }

        function nextRound() {
            currentWord = wordBank[Math.floor(Math.random() * wordBank.length)];
            const choices = generateChoices(currentWord.en);
            const dynamicImg = `https://loremflickr.com/400/300/${currentWord.en.toLowerCase()},kids/all`;

            document.getElementById('app').innerHTML = `
                <div class="linear-card p-5">
                    <div class="flex justify-between mb-4">
                        <span class="text-orange-500 font-bold">ğŸ”¥ ${streak}</span>
                        <span class="text-blue-400 font-bold">Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}</span>
                    </div>
                    <div class="image-frame mb-6">
                        <img src="${dynamicImg}" alt="word" onerror="this.src='https://via.placeholder.com/400x300?text=${currentWord.en}'">
                    </div>
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <button onclick="speak(currentWord.en, 'en')" class="bg-blue-500/20 border border-blue-500/40 py-3 rounded-xl">ğŸ”Š English</button>
                        <button onclick="speak(currentWord.ar, 'ar')" class="bg-green-500/20 border border-green-500/40 py-3 rounded-xl">ğŸ”Š Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        ${choices.map(c => `<button onclick="check(this, '${c}')" class="option-btn">${c}</button>`).join('')}
                    </div>
                </div>
            `;
            setTimeout(() => speak(currentWord.en, 'en'), 300);
        }

        function generateChoices(correct) {
            let c = [correct];
            while(c.length < 4) {
                let r = wordBank[Math.floor(Math.random() * wordBank.length)].en;
                if(!c.includes(r)) c.push(r);
            }
            return c.sort(() => 0.5 - Math.random());
        }

        function check(btn, choice) {
            if(choice === currentWord.en) {
                btn.classList.add('correct');
                score += 10;
                streak++;
                if(streak === 5) {
                    speak("Well done champion!", "en");
                    setTimeout(showCelebration, 500);
                } else {
                    setTimeout(nextRound, 800);
                }
            } else {
                btn.classList.add('wrong');
                streak = 0;
                const btns = document.querySelectorAll('.option-btn');
                btns.forEach(b => { if(b.innerText === currentWord.en) b.classList.add('correct'); });
                setTimeout(nextRound, 1800);
            }
        }

        function showCelebration() { document.getElementById('celebration').style.display = 'flex'; }
        function closeCelebration() { 
            streak = 0;
            document.getElementById('celebration').style.display = 'none'; 
            nextRound(); 
        }

        renderHome();
    </script>
</body>
</html>
